- products = @group.all_products rescue Product.with_price
%h3 Выбрать
= form_tag url_for, {remote: true, method: 'get', id: 'filter', name: 'preferences'} do
  #price
    %h4 Цена
    = text_field_tag 'minPrice', params['minPrice'], {placeholder: @products_min, data: {min: @products_min, current: @min_price}}
    \-
    = text_field_tag 'maxPrice', params['maxPrice'], {placeholder: @products_max, data: {max: @products_max, current: @max_price}}
    руб.
    #price-slider

  #producer
    %h4 Производитель
    %ul
      - producers = products.uniq.pluck(:producer).sort
      - producers.each do |prdcr|
        - unless (prd_cntr = products.where{producer == prdcr}.count) == 0
          %li
            - checked = params[:producer].try(:index, prdcr) || (true if producers.count == 1)
            - disabled = true if producers.count == 1
            = check_box_tag 'producer[]', prdcr, checked, {multiple: true, id: prdcr.parameterize, disabled: disabled}
            = label_tag prdcr.parameterize, prdcr
            %span.count= "(#{prd_cntr})"
  - if @group.try(:properties).try(:any?)
    - @group.properties.each do |prop|
      .filter{id: prop.title.mb_chars.parameterize('_')}
        - if vals = values_of(prop).try(:sort_by) {|e| e.title.to_i}.presence
          %h4= prop.title
          %ul
            -# if (numeric? vals).count < 5 # store_helper
            - vals.each do |val|
              - unless (val_cntr = products.joins{values}.where{values.id == val.id}.count) == 0
                %li
                  - checked = params[:property].try(:index, val.id.to_s) || (true if vals.count == 1)
                  - disabled = true if vals.count == 1
                  = check_box_tag "property[]", val.id, checked, {multiple: true, disabled: disabled, id: 'val_'+val.id.to_s}
                  = label_tag 'val_'+val.id.to_s, val.title
                  %span.count= "(#{val_cntr})"
            -# else
              -#%input{:type => "text", value: numeric?(vals).min, name: "property[#{prop.id}][]"}/
              -#\ - 
              -#%input{:type => "text", value: numeric?(vals).max, name: "property[#{prop.id}][]"}/
              -#= vals.first.title.split(' ')[1]
  %input{type: "button", value: "Сброс"}/ 